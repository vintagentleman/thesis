\documentclass[specialist, subf, substylefile=spbu.rtx]{disser}

% Поля
\usepackage[%
    a4paper, includefoot,
    left=3.5cm, right=1cm,
    top=2cm, bottom=2cm,
    headsep=1cm, footskip=1cm
]{geometry}
\usepackage{lscape}

% Локализация
\usepackage{fontspec}
\usepackage{xecyr}
\usepackage[polish, english, russian]{babel}

% Шрифты
\defaultfontfeatures{Ligatures=TeX, Mapping=tex-text, HyphenChar="002D}
\setmainfont[Ligatures={TeX, Historic}]{Times New Roman}
\setsansfont{Arial}
\setmonofont{Consolas}

% Оформление
\usepackage{fvextra}
\usepackage{setspace}
\usepackage{afterpage}
\usepackage[babel]{microtype}
\usepackage[autostyle]{csquotes}
\usepackage[decimalsymbol=comma]{siunitx}
\usepackage[%
    xetex,
    bookmarksnumbered,
    bookmarksopen,
    colorlinks,
    allcolors=blue,
    hyperfootnotes=false
]{hyperref}

% Глубина нумерации разделов и оглавления
\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{2}

% Нумерация страниц снизу и по центру
\pagestyle{footcenter}
\chapterpagestyle{footcenter}

% Сноски
\usepackage[bottom]{footmisc}
\usepackage{chngcntr}
\counterwithout{footnote}{chapter}

% Списки
\usepackage[defblank]{paralist}
\setdefaultleftmargin{\parindent}{}{}{}{}{}

% Колонки
\usepackage{multicol}

% Таблицы
\usepackage{booktabs}
\usepackage{multirow}
\usepackage{makecell}
\usepackage{ltablex}
\keepXColumns
\renewcommand\theadfont{\bfseries\small}
\newcolumntype{P}[1]{>{\centering\arraybackslash}p{#1}}
\newcolumntype{R}[1]{>{\raggedleft\arraybackslash}p{#1}}

% Графика
\usepackage{textcomp}
\usepackage{graphicx}
\usepackage{subcaption}
\graphicspath{{fig/}}

\usepackage{tikz}
\usepackage{tikzscale}
\usepackage{forest}
\usetikzlibrary{arrows.meta}

\forestset{
    default preamble={
        before typesetting nodes={
            !r.replace by={[, coordinate, append]}
        },
        where n children=0{
            tier=word,
        }{
            rectangle, aspect=2,
        },
        where level=0{}{
            if n=1{
                edge label={node[pos=.2, above] {да}},
            }{
                edge label={node[pos=.2, above] {нет}},
            }
        },
        for tree={
            base=botton,
            child anchor=north,
            parent anchor=south,
            align=center,
            edge+={thick, -Latex},
            s sep'+=5cm,
            draw,
            thick,
            edge path'={ (!u) -| (.parent)},
        }
    }
}

% Счётчики глав и приложений
\usepackage{totcount}
\usepackage{assoccnt}

\newcounter{appnum}
\regtotcounter{appnum}

\newcounter{chpnum}
\DeclareAssociatedCounters{chapter}{chpnum}
\regtotcounter{chpnum}

\preto\appendix{%
    \setcounter{chpnum}{\value{chapter}}
    \setcounter{appnum}{1}
}

% Библиография
\input{../bib/biblatex}

% Аббревиатуры без переносов
\hyphenation{англ}
\hyphenation{подкл}
\hyphenation{СПбГУ}

\sloppy

\begin{document}

% Титульный лист, аннотация, оглавление
\input{title}
\input{abstract}
\tableofcontents

% Текст работы
\input{intro}
\input{1}
\input{2}
\input{concl}

% Библиография
\printbibliography[heading=bibintoc]

% Список сокращений
\input{acronyms}

% Приложения
\appendix
\input{app-a}

\end{document}
